// ============================================================
// DATABASE KOORDINAT (HANYA DATA PETA)
// ============================================================

// 1. MASTER: DESA GALIH (Garis Kuning Putus-putus)
const POLY_DESA_GALIH = [
    [-7.808762, 112.896381], [-7.809949, 112.896231], [-7.810725, 112.896394], [-7.812848, 112.895910], 
    [-7.813272, 112.897058], [-7.813911, 112.897229], [-7.815008, 112.897272], [-7.815752, 112.897711],
    [-7.816275, 112.897639], [-7.818646, 112.899821], [-7.818396, 112.900724], [-7.819161, 112.900734],
    [-7.819707, 112.900403], [-7.820462, 112.901146], [-7.820489, 112.901897], [-7.820361, 112.902680],
    [-7.821101, 112.902778], [-7.821795, 112.902688], [-7.822534, 112.902490], [-7.823555, 112.903113],
    [-7.823933, 112.903573], [-7.824078, 112.904661], [-7.824179, 112.905970], [-7.823780, 112.906853],
    [-7.823796, 112.907674], [-7.823195, 112.909083], [-7.823130, 112.910525], [-7.824248, 112.911659],
    [-7.825552, 112.912372], [-7.825921, 112.912869], [-7.826685, 112.913142], [-7.827294, 112.913384],
    [-7.827611, 112.914082], [-7.827434, 112.914600], [-7.828445, 112.914744], [-7.829121, 112.915242],
    [-7.829724, 112.919683], [-7.829774, 112.920048], [-7.828535, 112.919647], [-7.828432, 112.919558],
    [-7.828413, 112.919540], [-7.828376, 112.919520], [-7.828316, 112.919488], [-7.828194, 112.919422],
    [-7.828133, 112.919390], [-7.828103, 112.919374], [-7.828065, 112.919353], [-7.827964, 112.919298],
    [-7.827860, 112.919175], [-7.827761, 112.919055], [-7.827665, 112.918939], [-7.827595, 112.918857],
    [-7.827528, 112.918771], [-7.827393, 112.918597], [-7.827041, 112.918547], [-7.826591, 112.918336],
    [-7.826183, 112.917986], [-7.825943, 112.917729], [-7.825852, 112.917630], [-7.825464, 112.917424],
    [-7.825083, 112.917494], [-7.824928, 112.917500], [-7.824777, 112.917500], [-7.824723, 112.917558],
    [-7.824659, 112.917623], [-7.824439, 112.917533], [-7.824390, 112.917512], [-7.824340, 112.917496],
    [-7.824205, 112.917452], [-7.823483, 112.917647], [-7.823249, 112.917706], [-7.822929, 112.917587],
    [-7.822795, 112.917539], [-7.822667, 112.917531], [-7.822351, 112.917505], [-7.822225, 112.917498],
    [-7.821987, 112.917575], [-7.821948, 112.917591], [-7.821904, 112.917623], [-7.821843, 112.917672],
    [-7.821784, 112.917713], [-7.821526, 112.917771], [-7.821479, 112.917785], [-7.821425, 112.917786],
    [-7.821264, 112.917789], [-7.821150, 112.917809], [-7.820990, 112.917791], [-7.820848, 112.917715],
    [-7.820688, 112.917685], [-7.820492, 112.917726], [-7.820278, 112.917746], [-7.820152, 112.917726],
    [-7.820028, 112.917807], [-7.819710, 112.917641], [-7.819483, 112.917595], [-7.819357, 112.917528],
    [-7.819274, 112.917400], [-7.819244, 112.917358], [-7.819209, 112.917315], [-7.819124, 112.917244],
    [-7.819010, 112.917221], [-7.818961, 112.917216], [-7.818911, 112.917220], [-7.818677, 112.917215],
    [-7.818534, 112.917259], [-7.818393, 112.917344], [-7.818179, 112.917383], [-7.818092, 112.917405],
    [-7.817989, 112.917451], [-7.817897, 112.917472], [-7.817808, 112.917491], [-7.817620, 112.917523],
    [-7.817452, 112.917573], [-7.817372, 112.917596], [-7.817282, 112.917619], [-7.817077, 112.917625],
    [-7.816700, 112.917523], [-7.816548, 112.917459], [-7.816186, 112.917477], [-7.815800, 112.917534],
    [-7.815418, 112.917572], [-7.815258, 112.917558], [-7.815132, 112.917608], [-7.814986, 112.917583],
    [-7.814910, 112.917572], [-7.814757, 112.917502], [-7.814695, 112.917488], [-7.814662, 112.917499],
    [-7.814631, 112.917508], [-7.814394, 112.917585], [-7.814242, 112.917655], [-7.814118, 112.917759],
    [-7.813776, 112.917912], [-7.813694, 112.917952], [-7.813573, 112.918121], [-7.813405, 112.918391],
    [-7.813340, 112.918544], [-7.813212, 112.918659], [-7.813115, 112.918737], [-7.812890, 112.918850],
    [-7.812689, 112.919122], [-7.812583, 112.919256], [-7.812437, 112.919401], [-7.812344, 112.919417],
    [-7.812244, 112.919433], [-7.811920, 112.919307], [-7.811751, 112.919253], [-7.811595, 112.919180],
    [-7.811349, 112.919058], [-7.811136, 112.918912], [-7.810857, 112.918829], [-7.810748, 112.918798],
    [-7.810653, 112.918808], [-7.810541, 112.918828], [-7.810421, 112.918850], [-7.810367, 112.918867],
    [-7.810312, 112.918855], [-7.810149, 112.918800], [-7.810059, 112.918749], [-7.809892, 112.918654],
    [-7.809798, 112.918613], [-7.809712, 112.918593], [-7.809357, 112.918530], [-7.809066, 112.918619],
    [-7.808757, 112.918622], [-7.808157, 112.918572], [-7.808099, 112.918568], [-7.808047, 112.918585],
    [-7.807910, 112.918646], [-7.807648, 112.918748], [-7.807142, 112.918960], [-7.806919, 112.919074],
    [-7.806808, 112.919146], [-7.806667, 112.919230], [-7.806556, 112.919306], [-7.806435, 112.919367],
    [-7.806300, 112.919427], [-7.806162, 112.919451], [-7.805938, 112.919476], [-7.805708, 112.919484],
    [-7.805567, 112.919482], [-7.805260, 112.919370], [-7.804508, 112.919152], [-7.804080, 112.919080],
    [-7.803473, 112.919151], [-7.803074, 112.919166], [-7.802736, 112.919274], [-7.801967, 112.919551],
    [-7.801602, 112.919579], [-7.801448, 112.919584], [-7.801239, 112.919550], [-7.801069, 112.919463],
    [-7.800903, 112.919401], [-7.800460, 112.919272], [-7.799433, 112.918981], [-7.799337, 112.918953],
    [-7.799281, 112.918987], [-7.799133, 112.919068], [-7.799017, 112.919121], [-7.798747, 112.919251],
    [-7.798480, 112.919371], [-7.798124, 112.919422], [-7.797709, 112.919479], [-7.797230, 112.919586],
    [-7.796923, 112.919667], [-7.796681, 112.919582], [-7.796557, 112.919540], [-7.796498, 112.919517],
    [-7.796444, 112.919484], [-7.796265, 112.919369], [-7.796172, 112.919311], [-7.796095, 112.919241],
    [-7.795856, 112.918999], [-7.795734, 112.918876], [-7.795607, 112.918751], [-7.795506, 112.918651],
    [-7.795409, 112.918546], [-7.795195, 112.918327], [-7.794935, 112.918056], [-7.794721, 112.917835],
    [-7.794509, 112.917613], [-7.794385, 112.917485], [-7.794251, 112.917396], [-7.793982, 112.917221],
    [-7.793774, 112.917084], [-7.793438, 112.917008], [-7.793132, 112.916948], [-7.792824, 112.916890],
    [-7.792633, 112.916853], [-7.792508, 112.916888], [-7.792286, 112.916940], [-7.792271, 112.916529],
    [-7.792327, 112.915885], [-7.792430, 112.915241], [-7.792513, 112.914834], [-7.792806, 112.914164],
    [-7.793244, 112.912589], [-7.793133, 112.910419], [-7.792862, 112.908891], [-7.792546, 112.907823],
    [-7.791499, 112.907447], [-7.790597, 112.907332], [-7.789350, 112.907732], [-7.788072, 112.907674],
    [-7.787715, 112.907215], [-7.787841, 112.906806], [-7.787661, 112.905639], [-7.788452, 112.898582],
    [-7.789726, 112.896976], [-7.790645, 112.896544], [-7.791369, 112.896043], [-7.792515, 112.895868],
    [-7.793827, 112.895279], [-7.794788, 112.895187], [-7.796051, 112.895214], [-7.797249, 112.895203],
    [-7.798318, 112.895220], [-7.799194, 112.895661], [-7.800123, 112.895726], [-7.800920, 112.895667],
    [-7.801298, 112.895249], [-7.802147, 112.894652], [-7.802471, 112.894794], [-7.802755, 112.895035],
    [-7.803399, 112.895195], [-7.804655, 112.895078], [-7.805747, 112.895103], [-7.807085, 112.895810],
    [-7.807522, 112.895894], [-7.808761, 112.895559], [-7.808762, 112.896381]
];

// 2. MASTER: PETUNG (Garis Orange Putus-putus)
const POLY_PETUNG = [
    [-7.796914, 112.919663], [-7.797714, 112.919479], [-7.798473, 112.919373], [-7.798972, 112.919149],
    [-7.799335, 112.918953], [-7.800971, 112.919417], [-7.801221, 112.919538], [-7.801476, 112.919587],
    [-7.801947, 112.919557], [-7.802550, 112.919333], [-7.803031, 112.919182], [-7.803634, 112.919162],
    [-7.804106, 112.919072], [-7.804672, 112.919183], [-7.805290, 112.919377], [-7.805566, 112.919481],
    [-7.805921, 112.919479], [-7.806273, 112.919438], [-7.806556, 112.919309], [-7.807004, 112.919015],
    [-7.808091, 112.918568], [-7.808674, 112.918621], [-7.809053, 112.918619], [-7.809347, 112.918523],
    [-7.809793, 112.918603], [-7.810145, 112.918798], [-7.810358, 112.918865], [-7.810559, 112.918819],
    [-7.810750, 112.918797], [-7.810894, 112.918836], [-7.811133, 112.918912], [-7.811351, 112.919059],
    [-7.811691, 112.919227], [-7.812056, 112.919354], [-7.812242, 112.919435], [-7.812440, 112.919399],
    [-7.812625, 112.919209], [-7.812884, 112.918850], [-7.813134, 112.918722], [-7.813328, 112.918553],
    [-7.813415, 112.918354], [-7.813691, 112.917952], [-7.814118, 112.917759], [-7.814240, 112.917658],
    [-7.814388, 112.917587], [-7.814628, 112.917509], [-7.814694, 112.917488], [-7.814772, 112.917507],
    [-7.814903, 112.917569], [-7.815128, 112.917606], [-7.815253, 112.917557], [-7.815405, 112.917571],
    [-7.815704, 112.917542], [-7.816216, 112.917475], [-7.816534, 112.917452], [-7.816769, 112.917534],
    [-7.817074, 112.917624], [-7.817245, 112.917628], [-7.817411, 112.917584], [-7.817590, 112.917528],
    [-7.817850, 112.917483], [-7.817984, 112.917450], [-7.818143, 112.917390], [-7.818389, 112.917346],
    [-7.818538, 112.917258], [-7.818682, 112.917214], [-7.818983, 112.917217], [-7.819126, 112.917244],
    [-7.819231, 112.917336], [-7.819329, 112.917483], [-7.819392, 112.917544], [-7.819465, 112.917592],
    [-7.819703, 112.917641], [-7.820021, 112.917802], [-7.820145, 112.917733], [-7.820210, 112.917735],
    [-7.820277, 112.917746], [-7.820400, 112.917726], [-7.820502, 112.917721], [-7.820682, 112.917681],
    [-7.820844, 112.917709], [-7.820990, 112.917790], [-7.821149, 112.917808], [-7.821267, 112.917788],
    [-7.821464, 112.917787], [-7.821612, 112.917751], [-7.821788, 112.917710], [-7.821955, 112.917587],
    [-7.822231, 112.917496], [-7.822795, 112.917538], [-7.823247, 112.917706], [-7.824206, 112.917451],
    [-7.824391, 112.917512], [-7.824658, 112.917623], [-7.824777, 112.917501], [-7.825082, 112.917495],
    [-7.825460, 112.917423], [-7.825848, 112.917625], [-7.826166, 112.917971], [-7.826587, 112.918332],
    [-7.827044, 112.918548], [-7.827393, 112.918595], [-7.827596, 112.918858], [-7.827962, 112.919297],
    [-7.828411, 112.919538], [-7.828847, 112.919916], [-7.829622, 112.920887], [-7.829436, 112.922094],
    [-7.829514, 112.922454], [-7.829491, 112.922727], [-7.829389, 112.923354], [-7.829246, 112.924479],
    [-7.828884, 112.926453], [-7.828586, 112.927328], [-7.828414, 112.927775], [-7.828083, 112.928694],
    [-7.827810, 112.929753], [-7.827647, 112.930261], [-7.827504, 112.930627], [-7.827291, 112.931113],
    [-7.827284, 112.931321], [-7.827288, 112.931560], [-7.827291, 112.931858], [-7.827284, 112.932148],
    [-7.827259, 112.933403], [-7.827406, 112.934486], [-7.827424, 112.934596], [-7.827424, 112.934671],
    [-7.827429, 112.934862], [-7.827437, 112.935081], [-7.827440, 112.935197], [-7.827444, 112.935299],
    [-7.827456, 112.935495], [-7.827432, 112.935706], [-7.827387, 112.935945], [-7.827362, 112.936159],
    [-7.827355, 112.936221], [-7.827347, 112.936274], [-7.827313, 112.936484], [-7.827277, 112.936696],
    [-7.827240, 112.936905], [-7.827109, 112.937147], [-7.827046, 112.937365], [-7.826915, 112.937344],
    [-7.826699, 112.937294], [-7.826497, 112.937245], [-7.826359, 112.937189], [-7.826223, 112.937160],
    [-7.826067, 112.936973], [-7.825922, 112.936760], [-7.825721, 112.936556], [-7.824473, 112.936202],
    [-7.823816, 112.936135], [-7.822422, 112.935926], [-7.821125, 112.935331], [-7.820555, 112.935382],
    [-7.820142, 112.935495], [-7.819798, 112.935741], [-7.819580, 112.935989], [-7.819173, 112.935895],
    [-7.818673, 112.935711], [-7.818305, 112.935755], [-7.817943, 112.935891], [-7.817541, 112.935848],
    [-7.816874, 112.935461], [-7.815550, 112.934849], [-7.814764, 112.934505], [-7.813814, 112.934379],
    [-7.812598, 112.934145], [-7.810570, 112.933965], [-7.809489, 112.934184], [-7.807909, 112.934547],
    [-7.806408, 112.934564], [-7.805737, 112.934772], [-7.804795, 112.935598], [-7.803789, 112.935324],
    [-7.803192, 112.935287], [-7.802172, 112.935870], [-7.801021, 112.935521], [-7.800043, 112.935780],
    [-7.799307, 112.935640], [-7.798808, 112.935522], [-7.797865, 112.935338], [-7.796820, 112.934946],
    [-7.796267, 112.934272], [-7.795532, 112.934125], [-7.794864, 112.933069], [-7.794896, 112.932045],
    [-7.794489, 112.931746], [-7.793586, 112.931982], [-7.793510, 112.931545], [-7.793202, 112.930642],
    [-7.792880, 112.930522], [-7.792371, 112.930755], [-7.791249, 112.930842], [-7.790806, 112.931157],
    [-7.789550, 112.931263], [-7.788581, 112.931947], [-7.786136, 112.933870], [-7.785245, 112.933920],
    [-7.784061, 112.934598], [-7.782732, 112.934763], [-7.781894, 112.934225], [-7.781402, 112.933933],
    [-7.780761, 112.933728], [-7.780420, 112.934090], [-7.780153, 112.923638], [-7.780132, 112.921933],
    [-7.777995, 112.921008], [-7.777656, 112.920664], [-7.777560, 112.920252], [-7.777596, 112.919576],
    [-7.777495, 112.919307], [-7.777329, 112.919059], [-7.777063, 112.918702], [-7.777014, 112.918092],
    [-7.776446, 112.916364], [-7.776426, 112.914567], [-7.776211, 112.913816], [-7.776012, 112.913170],
    [-7.778111, 112.912734], [-7.778752, 112.913294], [-7.779409, 112.913824], [-7.779588, 112.913928],
    [-7.779663, 112.914042], [-7.779666, 112.914422], [-7.779977, 112.915403], [-7.780988, 112.916320],
    [-7.781197, 112.916585], [-7.781513, 112.916755], [-7.781888, 112.916864], [-7.782284, 112.916968],
    [-7.783083, 112.917021], [-7.783809, 112.916871], [-7.785225, 112.916404], [-7.787328, 112.916398],
    [-7.788040, 112.917301], [-7.789446, 112.918222], [-7.790695, 112.916773], [-7.791421, 112.916791],
    [-7.791831, 112.916885], [-7.792232, 112.916956], [-7.792639, 112.916854], [-7.793248, 112.916967],
    [-7.793770, 112.917083], [-7.794375, 112.917476], [-7.795551, 112.918696], [-7.796152, 112.919295],
    [-7.796494, 112.919515], [-7.796914, 112.919663]
];

// 3. MASTER: HUTAN LINDUNG (Garis Hijau Putus-putus)
const POLY_HUTAN_LINDUNG = [
    [-7.804688, 112.906485], [-7.805071, 112.906485], [-7.805539, 112.906528], [-7.805730, 112.906378],
    [-7.805666, 112.906270], [-7.805964, 112.906270], [-7.806219, 112.906227], [-7.806431, 112.905970],
    [-7.806389, 112.906013], [-7.807112, 112.905755], [-7.806857, 112.905884], [-7.806644, 112.906013],
    [-7.806431, 112.906099], [-7.807027, 112.905863], [-7.807218, 112.905691], [-7.807324, 112.905755],
    [-7.807409, 112.905669], [-7.807494, 112.905627], [-7.807962, 112.905669], [-7.808260, 112.905755],
    [-7.808982, 112.905455], [-7.808982, 112.905433], [-7.809238, 112.905541], [-7.809514, 112.905498],
    [-7.809897, 112.905476], [-7.809323, 112.905498], [-7.809556, 112.905455], [-7.809641, 112.905562],
    [-7.809280, 112.905498], [-7.809152, 112.905455], [-7.809365, 112.905519], [-7.809216, 112.905305],
    [-7.809386, 112.905412], [-7.809769, 112.905412], [-7.810130, 112.905412], [-7.810513, 112.905412],
    [-7.810789, 112.905691], [-7.811108, 112.906142], [-7.811130, 112.906292], [-7.811300, 112.906313],
    [-7.811215, 112.906528], [-7.811172, 112.906699], [-7.811300, 112.906850], [-7.811066, 112.906871],
    [-7.810959, 112.907064], [-7.810683, 112.907558], [-7.809726, 112.908395], [-7.809004, 112.909274],
    [-7.808345, 112.909982], [-7.807090, 112.909510], [-7.805772, 112.908974], [-7.803583, 112.908416],
    [-7.802775, 112.908566], [-7.802010, 112.908588], [-7.802095, 112.908287], [-7.802371, 112.907708],
    [-7.802435, 112.907386], [-7.802498, 112.907193], [-7.802318, 112.907118], [-7.802180, 112.906914],
    [-7.802413, 112.906699], [-7.803115, 112.906506], [-7.803200, 112.906485], [-7.803328, 112.906528],
    [-7.803668, 112.906313], [-7.803923, 112.906227], [-7.804305, 112.906399], [-7.804688, 112.906485]
];

// 4. DETAIL POLYGONS 2024 (17 Lokasi - Warna Warni)
const DATA_2024_POLYGONS = [
    { name: "Hutan Lestari Supinto", color: "#006064", coords: [[-7.81659, 112.90507], [-7.81658, 112.90507], [-7.81657, 112.90507], [-7.81656, 112.90506], [-7.81656, 112.90507], [-7.81656, 112.90508], [-7.81656, 112.90509], [-7.81656, 112.9051], [-7.81656, 112.90511], [-7.81655, 112.90515], [-7.81652, 112.90519], [-7.81654, 112.90521], [-7.81654, 112.90523], [-7.81654, 112.90524], [-7.81652, 112.90527], [-7.81651, 112.90529], [-7.8165, 112.9053], [-7.8165, 112.90531], [-7.81649, 112.90533], [-7.81648, 112.90534], [-7.81647, 112.90535], [-7.81647, 112.90536], [-7.81644, 112.90538], [-7.81643, 112.90538], [-7.81641, 112.90538], [-7.81639, 112.90538], [-7.81636, 112.90537], [-7.81634, 112.90537], [-7.81631, 112.90536], [-7.81629, 112.90536], [-7.81624, 112.90534], [-7.81622, 112.90534], [-7.81611, 112.90531], [-7.8162, 112.90477], [-7.81632, 112.90463], [-7.81646, 112.90486], [-7.81659, 112.90507]] },
    { name: "Hutan lestari Karji", color: "#e65100", coords: [[-7.81367, 112.90254], [-7.81386, 112.90275], [-7.81376, 112.903], [-7.81353, 112.90317], [-7.81335, 112.90337], [-7.81329, 112.90329], [-7.8133, 112.90321], [-7.81329, 112.90316], [-7.81329, 112.90315], [-7.81331, 112.90313], [-7.81331, 112.90311], [-7.81331, 112.9031], [-7.81332, 112.90308], [-7.81331, 112.90307], [-7.81331, 112.90304], [-7.8133, 112.90302], [-7.81329, 112.90301], [-7.81329, 112.903], [-7.81329, 112.90298], [-7.81327, 112.90293], [-7.81327, 112.90292], [-7.81327, 112.90289], [-7.81326, 112.90287], [-7.81325, 112.90287], [-7.81323, 112.90284], [-7.81323, 112.90282], [-7.81323, 112.9028], [-7.81322, 112.90277], [-7.81322, 112.90274], [-7.81326, 112.90274], [-7.81327, 112.90273], [-7.81328, 112.90273], [-7.81333, 112.90269], [-7.81337, 112.90268], [-7.81347, 112.90263], [-7.81352, 112.90261], [-7.81357, 112.90259], [-7.81367, 112.90254]] },
    { name: "Hutan Lestari Andari 01", color: "#ff5252", coords: [[-7.8151, 112.90525], [-7.81511, 112.90527], [-7.8151, 112.90527], [-7.8151, 112.90528], [-7.81508, 112.90527], [-7.81502, 112.9053], [-7.815, 112.90533], [-7.81499, 112.90534], [-7.81498, 112.90534], [-7.81497, 112.90533], [-7.81497, 112.90532], [-7.81496, 112.90531], [-7.81495, 112.9053], [-7.81495, 112.90529], [-7.81496, 112.90526], [-7.81495, 112.90523], [-7.81495, 112.90521], [-7.81494, 112.90519], [-7.81494, 112.90518], [-7.81493, 112.90515], [-7.81493, 112.90512], [-7.81493, 112.90511], [-7.81493, 112.90508], [-7.81494, 112.90506], [-7.81494, 112.90505], [-7.81492, 112.90504], [-7.81491, 112.90503], [-7.81492, 112.90503], [-7.81493, 112.90502], [-7.81494, 112.90501], [-7.81495, 112.90499], [-7.81494, 112.90496], [-7.81511, 112.90473], [-7.81546, 112.90448], [-7.81597, 112.90459], [-7.8162, 112.90477], [-7.81611, 112.90531], [-7.81561, 112.90527], [-7.81535, 112.90526], [-7.8151, 112.90525]] },
    { name: "Hutan Lestari Juman Tugu 02", color: "#ffea00", coords: [[-7.81609, 112.91223], [-7.81625, 112.91193], [-7.81626, 112.91193], [-7.81627, 112.91195], [-7.81629, 112.91195], [-7.81631, 112.91196], [-7.81632, 112.91196], [-7.81635, 112.91197], [-7.81636, 112.91196], [-7.81637, 112.91197], [-7.81638, 112.91197], [-7.81638, 112.91198], [-7.81639, 112.91199], [-7.8164, 112.91199], [-7.8164, 112.912], [-7.81638, 112.91202], [-7.81637, 112.91203], [-7.81635, 112.91204], [-7.81636, 112.91205], [-7.81635, 112.91206], [-7.81635, 112.91207], [-7.81634, 112.91209], [-7.81634, 112.9121], [-7.81634, 112.91211], [-7.81635, 112.91212], [-7.81636, 112.91213], [-7.81637, 112.91214], [-7.81638, 112.91217], [-7.81639, 112.91219], [-7.81641, 112.9122], [-7.81641, 112.91222], [-7.81641, 112.91223], [-7.81642, 112.91224], [-7.81642, 112.91226], [-7.81639, 112.91234], [-7.81632, 112.91237], [-7.81609, 112.91223]] },
    { name: "Hutan Lestari Andari 02", color: "#01579b", coords: [[-7.80581, 112.90023], [-7.80538, 112.90012], [-7.80513, 112.89995], [-7.8052, 112.89969], [-7.8054, 112.8995], [-7.80566, 112.8994], [-7.8057, 112.89937], [-7.80572, 112.89937], [-7.80573, 112.89938], [-7.80574, 112.89938], [-7.80576, 112.89938], [-7.8058, 112.89939], [-7.80583, 112.89939], [-7.80585, 112.89939], [-7.80586, 112.89939], [-7.80587, 112.89939], [-7.80588, 112.89939], [-7.80589, 112.8994], [-7.80589, 112.89943], [-7.80588, 112.89945], [-7.80588, 112.89948], [-7.80587, 112.8995], [-7.80587, 112.89951], [-7.80588, 112.89953], [-7.80587, 112.89955], [-7.80587, 112.8996], [-7.80587, 112.89963], [-7.80587, 112.89967], [-7.80587, 112.89969], [-7.80588, 112.89972], [-7.80588, 112.89973], [-7.80589, 112.89974], [-7.80588, 112.89975], [-7.80588, 112.89977], [-7.8059, 112.89979], [-7.80591, 112.8998], [-7.80591, 112.89981], [-7.80592, 112.89983], [-7.80594, 112.89984], [-7.80596, 112.89985], [-7.80594, 112.89989], [-7.80593, 112.89994], [-7.80592, 112.89997], [-7.80591, 112.89999], [-7.80589, 112.90004], [-7.80581, 112.90023]] },
    { name: "Hutan Lestari Kariono Gondrong", color: "#3949ab", coords: [[-7.81266, 112.90895], [-7.81274, 112.90893], [-7.81276, 112.90894], [-7.8128, 112.90895], [-7.81282, 112.90896], [-7.81283, 112.90897], [-7.81288, 112.909], [-7.81289, 112.90901], [-7.81291, 112.90905], [-7.81291, 112.90906], [-7.81291, 112.90908], [-7.81291, 112.90914], [-7.8129, 112.90915], [-7.8129, 112.90916], [-7.81289, 112.90917], [-7.81289, 112.90918], [-7.81288, 112.90919], [-7.81284, 112.90924], [-7.81284, 112.90926], [-7.81283, 112.90926], [-7.81282, 112.90928], [-7.81281, 112.9093], [-7.81281, 112.90933], [-7.8128, 112.90934], [-7.81278, 112.90939], [-7.81278, 112.90941], [-7.81266, 112.9093], [-7.81261, 112.90925], [-7.81255, 112.9092], [-7.81261, 112.90907], [-7.81266, 112.90895]] },
    { name: "Hutan Lestari Misti", color: "#558b2f", coords: [[-7.81492, 112.91344], [-7.81492, 112.91372], [-7.81475, 112.91371], [-7.81458, 112.9137], [-7.81455, 112.91367], [-7.81455, 112.91364], [-7.81455, 112.91363], [-7.81454, 112.91361], [-7.81454, 112.9136], [-7.81455, 112.91357], [-7.81454, 112.91356], [-7.81454, 112.91355], [-7.81453, 112.91354], [-7.81453, 112.9135], [-7.81453, 112.91349], [-7.81453, 112.91348], [-7.81453, 112.91346], [-7.81454, 112.91343], [-7.81454, 112.91342], [-7.81453, 112.91342], [-7.81453, 112.91341], [-7.81452, 112.9134], [-7.81451, 112.9134], [-7.81451, 112.91339], [-7.8145, 112.91337], [-7.81448, 112.91332], [-7.81447, 112.91329], [-7.81447, 112.91328], [-7.81447, 112.91327], [-7.81447, 112.91326], [-7.81447, 112.91325], [-7.81446, 112.91323], [-7.81446, 112.91322], [-7.81445, 112.91321], [-7.81444, 112.9132], [-7.81443, 112.91319], [-7.81443, 112.91318], [-7.81442, 112.91317], [-7.81442, 112.91316], [-7.8144, 112.91315], [-7.8144, 112.91314], [-7.8144, 112.91313], [-7.81442, 112.91313], [-7.81443, 112.91312], [-7.81444, 112.91311], [-7.81448, 112.91305], [-7.81473, 112.91324], [-7.81492, 112.91344]] },
    { name: "Hutan Lestari Pecaton", color: "#0f9d58", coords: [[-7.82163, 112.906], [-7.82163, 112.9059], [-7.82163, 112.90579], [-7.82161, 112.90568], [-7.82155, 112.90558], [-7.82144, 112.90548], [-7.82127, 112.90545], [-7.8211, 112.90539], [-7.821, 112.90536], [-7.8209, 112.90523], [-7.82088, 112.90513], [-7.82087, 112.90504], [-7.82089, 112.90492], [-7.8209, 112.90479], [-7.82094, 112.90471], [-7.82099, 112.90462], [-7.82101, 112.90456], [-7.82102, 112.90449], [-7.82109, 112.90443], [-7.82115, 112.90442], [-7.82123, 112.90442], [-7.82132, 112.90446], [-7.82143, 112.90452], [-7.8215, 112.90455], [-7.82159, 112.90456], [-7.8217, 112.90457], [-7.82181, 112.90463], [-7.8219, 112.90465], [-7.82206, 112.9047], [-7.82216, 112.90471], [-7.82239, 112.90474], [-7.82262, 112.90481], [-7.82264, 112.90483], [-7.82266, 112.90486], [-7.82269, 112.9049], [-7.82283, 112.90496], [-7.82296, 112.90504], [-7.82334, 112.90518], [-7.82356, 112.90531], [-7.82355, 112.90557], [-7.82348, 112.90562], [-7.82339, 112.90563], [-7.82327, 112.90568], [-7.82333, 112.90573], [-7.82332, 112.90582], [-7.82344, 112.90596], [-7.82352, 112.90613], [-7.82353, 112.90622], [-7.82356, 112.90633], [-7.8235, 112.90641], [-7.82341, 112.90644], [-7.82338, 112.90638], [-7.8233, 112.90639], [-7.82329, 112.90659], [-7.82326, 112.90668], [-7.82324, 112.90676], [-7.82319, 112.90684], [-7.82312, 112.90693], [-7.8231, 112.90701], [-7.82318, 112.90705], [-7.82327, 112.90702], [-7.82327, 112.90712], [-7.82322, 112.90718], [-7.82317, 112.90736], [-7.82319, 112.90744], [-7.82317, 112.90757], [-7.8232, 112.90766], [-7.82329, 112.90773], [-7.82343, 112.90775], [-7.82353, 112.90778], [-7.82362, 112.90778], [-7.82368, 112.9078], [-7.82369, 112.90784], [-7.82367, 112.90791], [-7.82363, 112.908], [-7.82356, 112.9081], [-7.82336, 112.9085], [-7.82282, 112.90835], [-7.82267, 112.90832], [-7.82258, 112.90827], [-7.82245, 112.90813], [-7.82245, 112.90799], [-7.82248, 112.90782], [-7.82253, 112.90753], [-7.82247, 112.90745], [-7.82237, 112.9074], [-7.82225, 112.90742], [-7.82217, 112.90744], [-7.82208, 112.90745], [-7.82193, 112.90748], [-7.82186, 112.9075], [-7.82179, 112.90751], [-7.82167, 112.90756], [-7.82158, 112.90757], [-7.82149, 112.90756], [-7.82131, 112.90758], [-7.82119, 112.90758], [-7.82111, 112.90758], [-7.82105, 112.90761], [-7.82096, 112.90762], [-7.82084, 112.90766], [-7.82078, 112.90769], [-7.82071, 112.90773], [-7.82063, 112.90775], [-7.82054, 112.90781], [-7.82041, 112.90788], [-7.82027, 112.90794], [-7.82013, 112.90799], [-7.81977, 112.90806], [-7.81954, 112.90814], [-7.81948, 112.9079], [-7.81943, 112.9077], [-7.81942, 112.90761], [-7.81937, 112.90747], [-7.81932, 112.90733], [-7.81931, 112.90724], [-7.81927, 112.90716], [-7.81921, 112.90681], [-7.81927, 112.90664], [-7.81926, 112.90642], [-7.81932, 112.90642], [-7.81935, 112.90646], [-7.81938, 112.90649], [-7.81944, 112.90654], [-7.81965, 112.90661], [-7.8198, 112.90662], [-7.81992, 112.90662], [-7.82015, 112.90657], [-7.82026, 112.90652], [-7.82058, 112.90647], [-7.82073, 112.90645], [-7.82106, 112.90636], [-7.82166, 112.90617], [-7.82163, 112.906]] },
    { name: "Hutan Lestari Juman Gentong 01", color: "#ffd600", coords: [[-7.79375, 112.91429], [-7.79375, 112.91431], [-7.79375, 112.91434], [-7.79375, 112.91436], [-7.79375, 112.91438], [-7.79375, 112.9144], [-7.79375, 112.91442], [-7.79375, 112.91444], [-7.79375, 112.91445], [-7.79375, 112.91447], [-7.79376, 112.91448], [-7.79375, 112.91451], [-7.79374, 112.91452], [-7.79375, 112.91454], [-7.79375, 112.91455], [-7.79375, 112.91457], [-7.79376, 112.9146], [-7.79376, 112.91461], [-7.79375, 112.91466], [-7.79376, 112.9147], [-7.79376, 112.91473], [-7.79376, 112.91478], [-7.79377, 112.9148], [-7.79378, 112.91482], [-7.79378, 112.91483], [-7.79378, 112.91486], [-7.79378, 112.91487], [-7.79378, 112.91488], [-7.79378, 112.91489], [-7.79379, 112.91491], [-7.7938, 112.91493], [-7.79379, 112.91494], [-7.7938, 112.91497], [-7.7938, 112.91498], [-7.7938, 112.915], [-7.7938, 112.91501], [-7.7938, 112.91503], [-7.79379, 112.91504], [-7.79378, 112.91505], [-7.79377, 112.91504], [-7.79373, 112.91505], [-7.79371, 112.91505], [-7.79365, 112.915], [-7.79358, 112.915], [-7.79356, 112.915], [-7.79355, 112.915], [-7.79354, 112.91499], [-7.79354, 112.91498], [-7.79355, 112.91497], [-7.79354, 112.91496], [-7.79354, 112.91495], [-7.79354, 112.91493], [-7.79355, 112.9149], [-7.79354, 112.91487], [-7.79353, 112.91483], [-7.79352, 112.91481], [-7.79352, 112.91479], [-7.79352, 112.91475], [-7.79352, 112.91472], [-7.79352, 112.91469], [-7.79351, 112.91465], [-7.79351, 112.91462], [-7.7935, 112.91458], [-7.7935, 112.91456], [-7.7935, 112.91454], [-7.79349, 112.91449], [-7.79347, 112.91444], [-7.79347, 112.91442], [-7.79346, 112.91441], [-7.79345, 112.91438], [-7.79345, 112.91435], [-7.79345, 112.91434], [-7.79346, 112.91433], [-7.79346, 112.91432], [-7.79347, 112.91431], [-7.79346, 112.9143], [-7.79369, 112.91422], [-7.7937, 112.91422], [-7.79371, 112.9142], [-7.79374, 112.9142], [-7.79375, 112.91429]] },
    { name: "Hutan Lestari Seneto", color: "#880e4f", coords: [[-7.81678, 112.91058], [-7.8165, 112.91054], [-7.81651, 112.9105], [-7.81645, 112.91048], [-7.81646, 112.91047], [-7.81648, 112.91044], [-7.81652, 112.91041], [-7.81653, 112.91037], [-7.81656, 112.91034], [-7.81658, 112.91031], [-7.81661, 112.9103], [-7.81665, 112.91027], [-7.81667, 112.91026], [-7.81668, 112.91027], [-7.81669, 112.9103], [-7.8167, 112.9103], [-7.81673, 112.91029], [-7.81675, 112.91029], [-7.81677, 112.9103], [-7.81679, 112.9103], [-7.81681, 112.9103], [-7.81682, 112.91031], [-7.81683, 112.9103], [-7.81684, 112.91031], [-7.81685, 112.91032], [-7.81687, 112.91033], [-7.81689, 112.91031], [-7.81691, 112.91032], [-7.81693, 112.91031], [-7.81694, 112.9103], [-7.81695, 112.9103], [-7.81698, 112.91031], [-7.81701, 112.91031], [-7.81705, 112.91025], [-7.8173, 112.91015], [-7.81757, 112.91012], [-7.81743, 112.91079], [-7.81678, 112.91058]] },
    { name: "Hutan Lestari Ngadi", color: "#7cb342", coords: [[-7.80997, 112.91318], [-7.80977, 112.91304], [-7.80983, 112.91303], [-7.80984, 112.913], [-7.80985, 112.913], [-7.80985, 112.91298], [-7.80985, 112.91294], [-7.80986, 112.91291], [-7.80987, 112.91289], [-7.80987, 112.91286], [-7.80988, 112.91284], [-7.80989, 112.91283], [-7.80989, 112.91281], [-7.80989, 112.91278], [-7.80989, 112.91276], [-7.80989, 112.91274], [-7.8099, 112.91272], [-7.80992, 112.91272], [-7.80994, 112.91271], [-7.81009, 112.91267], [-7.81011, 112.91294], [-7.81026, 112.91317], [-7.81012, 112.91318], [-7.80997, 112.91318]] },
    { name: "Hutan lestari Kariono Brewok", color: "#0288d1", coords: [[-7.81441, 112.91303], [-7.8144, 112.91303], [-7.81439, 112.91303], [-7.81438, 112.91303], [-7.81437, 112.91302], [-7.81437, 112.91301], [-7.81437, 112.913], [-7.81437, 112.91298], [-7.81437, 112.91297], [-7.81437, 112.91295], [-7.81438, 112.91293], [-7.81439, 112.91283], [-7.81428, 112.91261], [-7.81425, 112.91244], [-7.81424, 112.91241], [-7.81425, 112.9124], [-7.81425, 112.91239], [-7.81426, 112.91239], [-7.81427, 112.91239], [-7.8143, 112.9124], [-7.81431, 112.9124], [-7.81434, 112.91238], [-7.81435, 112.91238], [-7.81438, 112.91238], [-7.81438, 112.91237], [-7.8144, 112.91237], [-7.81441, 112.91238], [-7.81442, 112.91238], [-7.81443, 112.91237], [-7.81444, 112.91237], [-7.81445, 112.91237], [-7.81446, 112.91237], [-7.81447, 112.91237], [-7.81448, 112.91238], [-7.81449, 112.91238], [-7.8145, 112.91237], [-7.81451, 112.91237], [-7.81452, 112.91237], [-7.81453, 112.91237], [-7.81454, 112.91238], [-7.81455, 112.91239], [-7.81455, 112.9124], [-7.81456, 112.91241], [-7.81456, 112.91243], [-7.81455, 112.91244], [-7.81455, 112.91245], [-7.81455, 112.91246], [-7.81455, 112.91247], [-7.81455, 112.91249], [-7.81455, 112.9125], [-7.81455, 112.91252], [-7.81455, 112.91254], [-7.81455, 112.91255], [-7.81455, 112.91256], [-7.81454, 112.91257], [-7.81455, 112.9126], [-7.81455, 112.91261], [-7.81455, 112.91262], [-7.81455, 112.91263], [-7.81456, 112.91266], [-7.81455, 112.91268], [-7.81456, 112.91273], [-7.81455, 112.91275], [-7.81454, 112.91277], [-7.81454, 112.9128], [-7.81455, 112.91283], [-7.81457, 112.91288], [-7.81457, 112.91298], [-7.81457, 112.91299], [-7.81458, 112.913], [-7.81458, 112.91301], [-7.81459, 112.91302], [-7.81459, 112.91303], [-7.81458, 112.91303], [-7.81457, 112.91303], [-7.81456, 112.91304], [-7.81454, 112.91303], [-7.81451, 112.91303], [-7.81448, 112.91303], [-7.81441, 112.91303]] },
    { name: "Hutan Lestari Suwito", color: "#f57c00", coords: [[-7.80048, 112.91187], [-7.80048, 112.91203], [-7.80019, 112.91204], [-7.80001, 112.91206], [-7.8, 112.91207], [-7.79997, 112.91206], [-7.79993, 112.91207], [-7.79991, 112.91207], [-7.79988, 112.91207], [-7.79987, 112.91207], [-7.79985, 112.91207], [-7.79984, 112.91207], [-7.79984, 112.91206], [-7.79984, 112.91204], [-7.79984, 112.91202], [-7.79985, 112.912], [-7.79986, 112.91197], [-7.79986, 112.91196], [-7.79987, 112.91192], [-7.79988, 112.91191], [-7.7999, 112.91191], [-7.79992, 112.91191], [-7.79993, 112.91191], [-7.79995, 112.91191], [-7.79998, 112.91191], [-7.80001, 112.9119], [-7.80006, 112.9119], [-7.8001, 112.9119], [-7.80014, 112.9119], [-7.80018, 112.91191], [-7.8002, 112.91191], [-7.80021, 112.91191], [-7.8003, 112.91189], [-7.80033, 112.91188], [-7.80034, 112.91188], [-7.80035, 112.91188], [-7.80036, 112.91187], [-7.80038, 112.91187], [-7.80039, 112.91187], [-7.80041, 112.91187], [-7.80043, 112.91188], [-7.80045, 112.91188], [-7.80048, 112.91187]] },
    { name: "Hutan Lestari Sudikso", color: "#c2185b", coords: [[-7.81358, 112.9038], [-7.81357, 112.9038], [-7.81356, 112.90379], [-7.81355, 112.90376], [-7.81354, 112.90373], [-7.81353, 112.9037], [-7.81351, 112.90367], [-7.81351, 112.90365], [-7.8135, 112.90363], [-7.81349, 112.9036], [-7.81347, 112.90357], [-7.81347, 112.90355], [-7.81347, 112.90353], [-7.81347, 112.90352], [-7.81346, 112.9035], [-7.81346, 112.90349], [-7.81345, 112.90347], [-7.81345, 112.90346], [-7.81345, 112.90345], [-7.81344, 112.90341], [-7.81343, 112.90337], [-7.81343, 112.90335], [-7.81342, 112.90333], [-7.81342, 112.90332], [-7.81341, 112.9033], [-7.81353, 112.90317], [-7.81366, 112.90308], [-7.81368, 112.90313], [-7.81369, 112.90315], [-7.8137, 112.90323], [-7.81371, 112.90325], [-7.81371, 112.90328], [-7.81371, 112.9033], [-7.81371, 112.90332], [-7.81373, 112.90335], [-7.81373, 112.90336], [-7.81373, 112.90338], [-7.81373, 112.9034], [-7.81373, 112.90341], [-7.81373, 112.90343], [-7.81373, 112.90345], [-7.81373, 112.90346], [-7.81374, 112.9035], [-7.81374, 112.90351], [-7.81375, 112.90353], [-7.81376, 112.90356], [-7.81377, 112.90358], [-7.81379, 112.90359], [-7.81379, 112.90362], [-7.81378, 112.90363], [-7.81378, 112.90364], [-7.81358, 112.9038]] },
    { name: "Hutan Lestari Sugita", color: "#097138", coords: [[-7.81366, 112.90308], [-7.81376, 112.903], [-7.81383, 112.903], [-7.81405, 112.90319], [-7.81418, 112.90348], [-7.814, 112.90369], [-7.81392, 112.90375], [-7.81389, 112.90376], [-7.81387, 112.90376], [-7.81386, 112.90377], [-7.81385, 112.90377], [-7.81383, 112.90375], [-7.81382, 112.90371], [-7.81381, 112.90368], [-7.8138, 112.90367], [-7.8138, 112.90364], [-7.8138, 112.90363], [-7.81379, 112.90361], [-7.81379, 112.90359], [-7.81377, 112.90358], [-7.81376, 112.90356], [-7.81375, 112.90353], [-7.81374, 112.90351], [-7.81374, 112.9035], [-7.81373, 112.90346], [-7.81373, 112.90345], [-7.81373, 112.90343], [-7.81373, 112.90341], [-7.81373, 112.9034], [-7.81373, 112.90338], [-7.81373, 112.90336], [-7.81373, 112.90335], [-7.81371, 112.90332], [-7.81371, 112.9033], [-7.81371, 112.90328], [-7.81371, 112.90325], [-7.81371, 112.90323], [-7.8137, 112.90319], [-7.81369, 112.90315], [-7.81368, 112.90312], [-7.81366, 112.90308]] },
    { name: "Hutan Lestari Sukarjo", color: "#fbc02d", coords: [[-7.8072, 112.90118], [-7.80682, 112.90143], [-7.80678, 112.9014], [-7.80675, 112.90135], [-7.80669, 112.90127], [-7.80667, 112.90123], [-7.80662, 112.90114], [-7.80659, 112.90107], [-7.80655, 112.90098], [-7.80653, 112.90087], [-7.80652, 112.9008], [-7.80654, 112.90077], [-7.80657, 112.90075], [-7.80683, 112.90069], [-7.80708, 112.90081], [-7.8072, 112.90118]] },
    { name: "Hutan lestari Wanto", color: "#f9a825", coords: [[-7.81374, 112.90433], [-7.81382, 112.90459], [-7.8132, 112.90437], [-7.81315, 112.90408], [-7.81313, 112.90399], [-7.81318, 112.90394], [-7.8132, 112.90393], [-7.81322, 112.90391], [-7.81324, 112.9039], [-7.81326, 112.90388], [-7.81328, 112.90386], [-7.81331, 112.90383], [-7.81335, 112.90382], [-7.81339, 112.90381], [-7.81344, 112.9038], [-7.8135, 112.9038], [-7.81357, 112.9038], [-7.81358, 112.9038], [-7.81367, 112.90406], [-7.81374, 112.90433]] }
];

// 2. DATA UTAMA (DATA REVISI SESUAI REQUEST)
const db_planting = {
    years: {
        "tanam_2021": {
            id: "tanam_2021", year: 2021, location: "Program Konservasi Hutan Lindung",
            // Data Sesuai SS2 Detail Page (5.000 Pohon, 250 Rorak, 10 Sumur, 300 Biopori)
            water_inputs: { tree: 5000, well: 10, biopore: 300, trench: 250, water_access: 0 },
            species: { "Alpukat": 105, "Nangka": 113, "Sukun": 67, "Keluwih": 27, "Jambu Air": 15, "Longan": 10, "Lainnya": 70 },
            points: [[-7.822, 112.905, "Pohon"], [-7.810, 112.907, "Pohon"]], 
            areaPolygon: [MASTER_HUTAN_LINDUNG]
        },
        "tanam_2022": {
            id: "tanam_2022", year: 2022, location: "Program Konservasi Tahun 2022",
            // Data Sesuai Kode Lama Anda
            water_inputs: { tree: 10000, well: 20, biopore: 300, trench: 750, water_access: 0 },
            species: { "Kopi Robusta": 9500, "Naungan": 500 },
            points: [[-7.814, 112.927, "Kopi"]], 
            areaPolygon: [MASTER_PETUNG]
        },
        "tanam_2023": {
            id: "tanam_2023", year: 2023, location: "Program Konservasi AQUA Keboncandi 2023",
            // REVISI: Sumur = 5
            water_inputs: { tree: 5000, well: 5, biopore: 110, trench: 500, water_access: 0 },
            species: { "Kopi Robusta": 4000, "Naungan": 1000 },
            points: [[-7.822, 112.905, "Kopi"]], 
            areaPolygon: []
        },
        "tanam_2024": {
            id: "tanam_2024", year: 2024, location: "Program Konservasi Tahun 2024",
            // REVISI: Rorak = 1500
            water_inputs: { tree: 2000, well: 1, biopore: 0, trench: 1500, water_access: 449.4 },
            species: { "Kopi Robusta": 1000, "Durian": 300, "Alpukat": 200, "Lainnya": 1000 },
            points: [[-7.81636, 112.90502, "Rorak Supinto"]], 
            areaPolygon: [...DATA_2024_POLYGONS]
        }
    }
};

// 3. LOGIKA PROGRAM
const SIPA_TARGET_MLY = 2996; 
const VWB_CONST = 0.024953938;
const RAIN_DAYS = 163;
const F_INF = 3;

function calculateImpact(inputs) {
    if (!inputs) return { total: 0, tree: 0, well: 0, trench: 0, bio: 0, access: 0 };
    let treeMLY = (inputs.tree / 400) * VWB_CONST * 31.536 * 0.75;
    let wellMLY = inputs.well * 16000 * RAIN_DAYS / 1000000;
    let bioMLY = inputs.biopore * 10 * F_INF * RAIN_DAYS / 1000000;
    let trenchMLY = inputs.trench * 2940 * F_INF * RAIN_DAYS / 1000000;
    let accessMLY = inputs.water_access || 0; 
    return {
        tree: treeMLY, well: wellMLY, bio: bioMLY, trench: trenchMLY, access: accessMLY,
        total: treeMLY + wellMLY + bioMLY + trenchMLY + accessMLY
    };
}

Chart.register(ChartDataLabels);
let totalT=0, totalR=0, totalReplenish=0;
let years=[], dataTrees=[], dataRorak=[], dataSumur=[], dataBiopori=[], dataReplenished=[];
let speciesTotal={};

const sortedKeys = Object.keys(db_planting.years).sort(); 

sortedKeys.forEach(key => {
    const item = db_planting.years[key];
    const inputs = item.water_inputs;
    
    totalT += inputs.tree;
    totalR += inputs.trench;
    
    let impact = calculateImpact(inputs);
    totalReplenish += impact.total;

    years.push(item.year);
    dataTrees.push(inputs.tree);
    dataRorak.push(inputs.trench);
    dataSumur.push(inputs.well);
    dataBiopori.push(inputs.biopore);
    dataReplenished.push(impact.total.toFixed(1));

    if(item.species){
        for (const [sp, val] of Object.entries(item.species)) {
            if(sp !== "Lainnya") speciesTotal[sp] = (speciesTotal[sp] || 0) + val;
        }
    }
});

document.getElementById('totalTrees').innerText = totalT.toLocaleString('id-ID');
document.getElementById('totalRorak').innerText = totalR.toLocaleString('id-ID');
document.getElementById('totalReplenish').innerText = totalReplenish.toLocaleString('id-ID', {maximumFractionDigits:0});

// --- MAP RENDER (FIXED & CLEAN) ---
var map = L.map('map').setView([-7.810, 112.908], 13);
L.tileLayer('https://mt0.google.com/vt/lyrs=y&hl=en&x={x}&y={y}&z={z}', { maxZoom: 20 }).addTo(map);

const iconTree = L.divIcon({html: '<div style="background:#2e7d32;width:8px;height:8px;border-radius:50%;border:1px solid white;"></div>'});
const iconRorak = L.divIcon({html: '<div style="background:#ff9800;width:10px;height:10px;border-radius:50%;border:1px solid white;"></div>'});

// 1. GAMBAR MASTER LAYER (HANYA SEKALI)
L.polygon(MASTER_DESA_GALIH, { 
    color: '#ffd600', 
    fillColor: 'transparent', 
    weight: 2, 
    dashArray: '5, 5',
    opacity: 0.8
}).bindPopup("Batas Desa Galih").addTo(map);

L.polygon(MASTER_PETUNG, {
    color: '#ff9100', 
    fillColor: 'transparent', 
    weight: 2, 
    dashArray: '5, 5'
}).bindPopup("Batas Desa Petung").addTo(map);

// 2. GAMBAR DATA TAHUNAN (DETAIL)
Object.values(db_planting.years).forEach(item => {
    if (item.areaPolygon) {
        item.areaPolygon.forEach(poly => {
            // A. Format Baru 2024 (Object dengan warna)
            if (poly.coords && poly.color) {
                L.polygon(poly.coords, { color: poly.color, fillColor: poly.color, fillOpacity: 0.6, weight: 1 }).bindPopup(poly.name).addTo(map);
            } 
            // B. Format Lama (Array Murni) - Cek panjang agar tidak menggambar ulang master desa yang besar
            else if (Array.isArray(poly) && poly.length < 50) { 
                L.polygon(poly, { color: '#00e676', fillColor: '#69f0ae', fillOpacity: 0.4, weight: 1 }).bindPopup(item.location).addTo(map);
            }
        });
    }
    if(item.points){
        item.points.forEach(pt => {
            let isRorak = pt[2].toLowerCase().includes("rorak");
            L.marker([pt[0], pt[1]], {icon: isRorak ? iconRorak : iconTree}).addTo(map);
        });
    }
});

// CHARTS
new Chart(document.getElementById('barChart'), {
    type: 'bar',
    data: { labels: years, datasets: [{ label: 'Pohon', data: dataTrees, backgroundColor: '#2e7d32', borderRadius:4 }] },
    options: { maintainAspectRatio: false, plugins: { legend: {display:false} }, scales: { y: {beginAtZero: true} } }
});

new Chart(document.getElementById('chartRorak'), {
    type: 'bar',
    data: { labels: years, datasets: [{ label: 'Rorak', data: dataRorak, backgroundColor: '#795548', borderRadius:4 }] },
    options: { maintainAspectRatio: false, plugins: { legend:{display:false} } }
});

new Chart(document.getElementById('chartSumur'), {
    type: 'bar',
    data: { labels: years, datasets: [{ label: 'Sumur Resapan', data: dataSumur, backgroundColor: '#0277bd', borderRadius:4 }, { label: 'Biopori', data: dataBiopori, backgroundColor: '#4fc3f7', borderRadius:4 } ] },
    options: { maintainAspectRatio: false, plugins: { legend:{position:'bottom'} }, scales:{x:{stacked:false}, y:{beginAtZero:true}} }
});

const sortedSpecies = Object.entries(speciesTotal).sort((a,b) => b[1] - a[1]);
const topSpecies = sortedSpecies.slice(0, 5);
let pieLabels = topSpecies.map(x => x[0]);
let pieData = topSpecies.map(x => x[1]);

new Chart(document.getElementById('pieChart'), {
    type: 'doughnut',
    data: { labels: pieLabels, datasets: [{ data: pieData, backgroundColor: ['#1b5e20', '#2e7d32', '#43a047', '#66bb6a', '#81c784'] }] },
    options: { maintainAspectRatio: false, plugins: { legend: { display: false } } }
});

new Chart(document.getElementById('wbChart'), {
    type: 'bar',
    data: {
        labels: years,
        datasets: [
            { type: 'line', label: 'Batas SIPA (2.996 ML/Y)', data: Array(years.length).fill(SIPA_TARGET_MLY), borderColor: '#d32f2f', borderWidth: 2, borderDash: [5, 5], pointRadius: 0, datalabels: { display: false } },
            { label: 'Total Infiltrasi (ML/Y)', data: dataReplenished, backgroundColor: '#0288d1', borderRadius: 4 }
        ]
    },
    options: { maintainAspectRatio: false, plugins: { legend: { position: 'bottom' }, datalabels: { anchor: 'end', align: 'top', color: '#333', formatter: Math.round } }, scales: { y: { beginAtZero: true } } }
});

// Table
const tbody = document.getElementById('tableBody');
sortedKeys.reverse().forEach(key => {
    const item = db_planting.years[key];
    const inp = item.water_inputs;
    const impact = calculateImpact(inp);
    tbody.innerHTML += `<tr><td class="ps-4 fw-bold">${item.year}</td><td>${item.location}</td><td class="text-center">${inp.tree.toLocaleString()}</td><td class="text-center">${inp.trench.toLocaleString()}</td><td class="text-center">${inp.well.toLocaleString()}</td><td class="text-center">${inp.biopore.toLocaleString()}</td><td class="text-end pe-4"><span class="badge bg-primary">${impact.total.toFixed(1)}</span></td><td><button class="btn btn-sm btn-outline-secondary px-3" onclick="window.location.href='planting_detail.html?id=${key}'">Detail</button></td></tr>`;
});
</script>
</body>
</html>
